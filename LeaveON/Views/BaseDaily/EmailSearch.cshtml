@model IEnumerable<jsaosorio.Models.Recipient>
@{
  ViewBag.Title = "DNCSearch";
}


<section class="content">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">
            Email

          </h3>
        </div>


        <div class="card-body">
          <table id="dnctable" class="display" style="width:100%">
            <thead>
              <tr>
                <th></th>
                <th>
                  Domain
                </th>
                <th>
                  deal
                </th>
                <th>
                  agent
                </th>
                <th>
                  Cor
                </th>
                <th>
                  Neg
                </th>
                <th>
                  date
                </th>
                <th>
                  type
                </th>
                <th>
                  datechange
                </th>
                @*<th>
            other1
          </th>
          <th>
            other2
          </th>
          <th>
            other3
          </th>*@
                <th>
                  Traffic_Share
                </th>
                <th>
                  Change
                </th>
                <th>
                  Rank
                </th>
                <th>
                  Monthly_Visits
                </th>
                <th>
                  FileName
                </th>

              </tr>
            </thead>

          </table>
          @*<input type="button" id="btnSelectedRows" value="Send Email" />*@
          @*<button id="btnSelectedRows">Show Selected Rows</button>*@
          <button id="ShowModal" type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
            Send Email
          </button>
          @*<button type="button" class="btn btn-primary btn-block btn-lg" data-toggle="modal" data-target="#myModal">
            Open modal
          </button>*@
        </div>
      </div>
    </div>
  </div>

</section>

<!-- Button trigger modal -->




  <!-- The Modal -->
  <div class="modal" id="myModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Select Emails</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        @{ Html.RenderPartial("_EmailSearch", Model);}

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>




@*<div id="test1"></div>*@

@*<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css" rel="stylesheet" />
  <link href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css" rel="stylesheet" />

  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>*@


<link href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css" rel="stylesheet" />

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>


<script>
  $(document).ready(function () {
    $("#dnctable").DataTable({
      "ajax": {
        "url": "/BaseDaily/GetEmailsList",
        "type": "POST",
        "datatype": "json"
      },
      "columns": [
        { "data": "selected", "name": "selected" },
        {
          "data": "Domain", "name": "Domain",
          "render": function (data, type, full) {
            return '<a href="/BaseHistoricals/Index?domain=' + full.Domain + '" data-toggle="tooltip" data-placement="top" title="View Domain Details">' + full.Domain + '</a>'

          }
        },
        { "data": "deal", "name": "deal" },
        { "data": "agent", "name": "agent" },
        { "data": "Cor", "name": "Cor" },
        { "data": "Neg", "name": "Neg" },
        { "data": "date", "name": "date" },
        { "data": "type", "name": "type" },
        { "data": "datechange", "name": "datechange" },
        //{ "data": "other1", "name": "other1" },
        //{ "data": "other2", "name": "other2" },
        //{ "data": "other3", "name": "other3" },
        { "data": "Traffic_Share", "name": "Traffic_Share" },
        { "data": "Change", "name": "Change" },
        { "data": "Rank", "name": "Rank" },
        { "data": "Monthly_Visits", "name": "Monthly_Visits" },
        { "data": "FileName", "name": "FileName" },


      ],

      "serverSide": "true",
      "order": [0, "asc"],
      "processing": "true",
      "language": {
        "processing": "processing... please wait"
      },
      columnDefs: [{
        data: null,
        defaultContent: '',
        orderable: false,
        className: 'select-checkbox',
        targets: 0
      }],
      select: {
        style: 'os',
        selector: 'td:first-child'
      },
      order: [[1, 'asc']]


    });


    // CSHTML
    $('#ShowModal').click(function () {
      var myArr = [];
      var selectedRows = table.rows('.selected').data().map(function (item) { return item.Domain; });
      for (var i = 0; i < selectedRows.length; i++) {
        myArr.push(selectedRows[i]);
      }
      $.ajax({
        url: '/BaseDaily/GetSelectedRows',
        type: "POST",
        data: { 'obj': myArr }
      })
        .done(function (data) {
          // res containing list of domains and its emails
          /*alert(res);*/

          //var parsed_data = JSON.parse(res);
          //alert(parsed_data);
          //alert('s');
          $("#NewData").html(data);

          //$("#NewData").html(res);
          //alert($("#NewData").html());


        })
        .fail(function (res) {
          alert('f');
        })

    });

    var table = $('#dnctable').DataTable();
    $('#example tbody').on('click', 'tr', function () {
      $(this).toggleClass('selected');
    });

    //$('.modal').click(function () {
    //  //alert(table.rows('.selected').data().length + ' row(s) selected');
    //  /*$('#modal').modal('show');*/
    //  $(".btn").click(function () {
    //    $("#exampleModal").modal('show');
    //  });

    //});

    //$('#showModal').click(function () {
    //  alert(table.rows('.selected').data().length + ' row(s) selected');

    //});

    //$('#myModal').modal('toggle');
    //$('#myModal').modal('show');
    //$('#myModal').modal('hide');

  });


</script>


